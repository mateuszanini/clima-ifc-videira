{"files":[{"id":"73524d8e-112d-45b7-986a-0d342da22008","name":"Código","type":"server_js","source":"var url \u003d \u0027http://clima.videira.ifc.edu.br/estatisticas/image/downld02.txt\u0027;\n\nfunction myFunction() {\n    var response \u003d UrlFetchApp.fetch(url);\n    Logger.log(response.getContentText());\n\n    return response.getContentText();\n\n}\n\nfunction doGet() {\n    return HtmlService\n        .createTemplateFromFile(\u0027index\u0027)\n        .evaluate()\n        .setTitle(\u0027Clima | IFC Videira\u0027)\n        .setFaviconUrl(\u0027http://www.myiconfinder.com/uploads/iconsets/256-256-e154aa56822591b968cc98ae9c72dd57.png\u0027)\n        .setSandboxMode(HtmlService.SandboxMode.IFRAME);\n}"},{"id":"75290e8f-c761-4243-979a-97c196c0f00a","name":"index","type":"html","source":"\u003c!DOCTYPE html\u003e\n\u003chtml lang\u003d\"pt-BR\"\u003e\n\n\u003chead\u003e\n    \u003cmeta charset\u003d\"UTF-8\"\u003e\n    \u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1.0\" /\u003e\n    \u003c!-- INCLUSÃO DE CSS --\u003e\n    \u003c!-- Materialize --\u003e\n    \u003clink rel\u003d\"stylesheet\" href\u003d\"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css\"\u003e\n    \u003c!-- FontAwesome \n    \u003clink href\u003d\"https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css\" rel\u003d\"stylesheet\" integrity\u003d\"sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1\" crossorigin\u003d\"anonymous\"\u003e--\u003e\n    \u003cscript src\u003d\"https://use.fontawesome.com/f3b1d6f13a.js\"\u003e\u003c/script\u003e\n    \u003c!-- CSS próprio --\u003e\n    \u003cstyle\u003e\n\n    \u003c/style\u003e\n\u003c/head\u003e\n\n\u003cbody\u003e\n\n    \u003c!-- Menu --\u003e\n    \u003cdiv class\u003d\"navbar-fixed\"\u003e\n        \u003cnav\u003e\n            \u003cdiv class\u003d\"container\"\u003e\n                \u003cdiv class\u003d\"nav-wrapper\"\u003e\n                    \u003ca href\u003d\"#\" class\u003d\"brand-logo\"\u003e\u003ci class\u003d\"fa fa-sun-o\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e Clima - IFC Videira\u003c/a\u003e\n                    \u003cul id\u003d\"nav-mobile\" class\u003d\"right hide-on-med-and-down\"\u003e\n                        \u003cli\u003e\u003ca href\u003d\"#modalDados\" class\u003d\"modal-trigger\"\u003e\u003ci class\u003d\"fa fa-database\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e Dados\u003c/a\u003e\u003c/li\u003e\n                        \u003cli\u003e\u003ca href\u003d\"http://clima.videira.ifc.edu.br/estatisticas/image/downld02.txt\" target\u003d\"_blank\"\u003e\u003ci class\u003d\"fa fa-share\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e\u003c/a\u003e\u003c/li\u003e\n                    \u003c/ul\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n        \u003c/nav\u003e\n    \u003c/div\u003e\n\n    \u003c!-- Modal --\u003e\n    \u003cdiv id\u003d\"modalDados\" class\u003d\"modal modal-fixed-footer\"\u003e\n        \u003cdiv class\u003d\"modal-content\"\u003e\n            \u003ctable class\u003d\"highlight centered\"\u003e\n                \u003cthead\u003e\n                    \u003ctr\u003e\n                        \u003cth data-field\u003d\"id\"\u003eData\u003c/th\u003e\n                        \u003cth data-field\u003d\"name\"\u003eHora\u003c/th\u003e\n                        \u003cth data-field\u003d\"price\"\u003eTemperatura (ºC)\u003c/th\u003e\n                    \u003c/tr\u003e\n                \u003c/thead\u003e\n                \u003ctbody id\u003d\"tabelaDados\"\u003e\n                \u003c/tbody\u003e\n            \u003c/table\u003e\n        \u003c/div\u003e\n        \u003cdiv class\u003d\"modal-footer\"\u003e\n            \u003ca href\u003d\"#\" class\u003d\"modal-action modal-close waves-effect btn-flat\"\u003eFechar\u003c/a\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n    \u003cdiv class\u003d\"container\"\u003e\n        \u003cdiv class\u003d\"row\"\u003e\n            \u003cdiv class\u003d\"col s8\"\u003e\n                \u003cdiv class\u003d\"row\"\u003e\n                    \u003cdiv class\u003d\"col s12\"\u003e\n                        \u003cdiv class\u003d\"card-panel center-align\"\u003e\n                            \u003cdiv id\u003d\"grafico\"\u003e\n\n                                \u003cdiv class\u003d\"preloader-wrapper active\"\u003e\n                                    \u003cdiv class\u003d\"spinner-layer spinner-red-only\"\u003e\n                                        \u003cdiv class\u003d\"circle-clipper left\"\u003e\n                                            \u003cdiv class\u003d\"circle\"\u003e\u003c/div\u003e\n                                        \u003c/div\u003e\n                                        \u003cdiv class\u003d\"gap-patch\"\u003e\n                                            \u003cdiv class\u003d\"circle\"\u003e\u003c/div\u003e\n                                        \u003c/div\u003e\n                                        \u003cdiv class\u003d\"circle-clipper right\"\u003e\n                                            \u003cdiv class\u003d\"circle\"\u003e\u003c/div\u003e\n                                        \u003c/div\u003e\n                                    \u003c/div\u003e\n                                \u003c/div\u003e\n\n                            \u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n            \u003c/div\u003e\n            \u003cdiv class\u003d\"col s4\"\u003e\n                \u003cdiv class\u003d\"row\"\u003e\n                    \u003cdiv class\u003d\"center-align\" id\u003d\"medias\"\u003e\n                        \u003cbr\u003e\n                        \u003cdiv class\u003d\"preloader-wrapper active\"\u003e\n                            \u003cdiv class\u003d\"spinner-layer spinner-red-only\"\u003e\n                                \u003cdiv class\u003d\"circle-clipper left\"\u003e\n                                    \u003cdiv class\u003d\"circle\"\u003e\u003c/div\u003e\n                                \u003c/div\u003e\n                                \u003cdiv class\u003d\"gap-patch\"\u003e\n                                    \u003cdiv class\u003d\"circle\"\u003e\u003c/div\u003e\n                                \u003c/div\u003e\n                                \u003cdiv class\u003d\"circle-clipper right\"\u003e\n                                    \u003cdiv class\u003d\"circle\"\u003e\u003c/div\u003e\n                                \u003c/div\u003e\n                            \u003c/div\u003e\n                        \u003c/div\u003e\n                    \u003c/div\u003e\n                \u003c/div\u003e\n                \n                \u003cdiv class\u003d\"row\"\u003e\n                  \u003cul class\u003d\"collapsible\" data-collapsible\u003d\"accordion\"\u003e\n                    \u003cli\u003e\n                      \u003cdiv class\u003d\"collapsible-header\"\u003e\u003ci class\u003d\"fa fa-info-circle\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e Legenda\u003c/div\u003e\n                      \u003cdiv class\u003d\"collapsible-body\"\u003e\u003cspan\u003e\n                      \u003cp\u003eMadrugada (00:00h as 06:00h)\u003c/p\u003e\n                      \u003cp\u003eManhã (06:01h as 13:00h)\u003c/p\u003e\n                      \u003cp\u003eTarde (13:01h as 18:00h)\u003c/p\u003e\n                      \u003cp\u003eNoite (18:01h as 23:59h)\u003c/p\u003e\n                      \u003c/span\u003e\u003c/div\u003e\n                    \u003c/li\u003e              \n                  \u003c/ul\u003e                    \n                \u003c/div\u003e\n\n            \u003c/div\u003e\n\n        \u003c/div\u003e\n    \u003c/div\u003e\n\n\n\n    \u003c!-- INCLUSÃO DE JAVASCRIPT --\u003e\n    \u003c!-- JQuery --\u003e\n    \u003cscript src\u003d\"https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js\"\u003e\u003c/script\u003e\n    \u003c!-- Materialize --\u003e\n    \u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js\"\u003e\u003c/script\u003e\n    \u003c!-- Plotly.js --\u003e\n    \u003cscript src\u003d\"https://cdn.plot.ly/plotly-latest.min.js\"\u003e\u003c/script\u003e\n    \u003c!-- Google Charts --\u003e\n    \u003cscript type\u003d\"text/javascript\" src\u003d\"https://www.gstatic.com/charts/loader.js\"\u003e\u003c/script\u003e\n    \u003c!-- JS próprio --\u003e\n    \u003cscript\u003e\n        $(document).ready(function() {\n            $(\u0027.modal\u0027).modal();\n            $(\u0027.collapsible\u0027).collapsible();            \n        });\n\n        function validaData(data) {\n            var patternData1 \u003d /^[0-9]{2}\\/[0-9]{2}\\/[0-9]{2}$/;\n            var patternData2 \u003d /^[0-9]{1}\\/[0-9]{2}\\/[0-9]{2}$/;\n\n            if (!patternData1.test(data) \u0026\u0026 !patternData2.test(data)) {\n                return false;\n            }\n            else {\n                return true;\n            }\n        }\n\n        function arredonda(valor) {\n            return (valor).toFixed(2);\n        }\n\n        //requisição para o app script\n        google.script.run.withSuccessHandler(sucesso).withFailureHandler(erro).myFunction();\n\n        var m \u003d [{\n            \u0027data\u0027: null,\n            \u0027media\u0027: 0.00,\n            \u0027minima\u0027: 50.0,\n            \u0027horaMinima\u0027: null,\n            \u0027maxima\u0027: 0.00,\n            \u0027horaMaxima\u0027: null,\n            \u0027madrugada\u0027: 0.00,\n            \u0027manha\u0027: 0.00,\n            \u0027tarde\u0027: 0.00,\n            \u0027noite\u0027: 0.00,\n        }];\n        var dia \u003d 0;\n        var qtd \u003d 0;\n        var qtdMadrugada \u003d 0;\n        var qtdManha \u003d 0;\n        var qtdTarde \u003d 0;\n        var qtdNoite \u003d 0;\n\n\n        function sucesso(response) {\n            // \\s - qualquer espaço em branco\n            // {2,} - em quantidade de dois ou mais\n            // g - apanhar todas as ocorrências, não só a primeira\n            // depois o replace faz a subsituição desses grupos de espaços pelo que fôr passado no segundo parâmetro. Neste caso ; , \u0027;\u0027);\n            var retorno \u003d response.replace(/\\s{2,}/g, \u0027;\u0027);\n\n            var dados \u003d retorno.split(\";\");\n\n            for (var i \u003d 0; i \u003c dados.length; i++) {\n                if (validaData(dados[i])) {\n                    var dataAtual \u003d dados[i];\n                    break;\n                }\n            }\n\n            for (var i \u003d 0; i \u003c dados.length; i++) {\n\n                if (validaData(dados[i])) {\n                    var data \u003d dados[i];\n                    var hora \u003d dados[i + 1];\n                    var temper \u003d dados[i + 2];\n                    //console.log(i + \" - Data: \" + data + \" - Hora: \" + hora + \" - Temperatura: \" + temper);\n\n                    /* 00:00 as 06:00 madrugada\n                    06:01 as 13:00 manhã\n                    13:01 as 18:00 tarde\n                    18:01 as 23:59 noite */\n\n                    var horaConvertida \u003d hora.replace(\":\", \"\");\n\n                    if (data \u003d\u003d dataAtual) {\n                        m[dia].data \u003d data;\n                        m[dia].media \u003d m[dia].media + parseFloat(temper);\n                        qtd++;\n\n                        //MADRUGADA\n                        if (horaConvertida \u003e\u003d 0 \u0026\u0026 horaConvertida \u003c\u003d 600) {\n                            m[dia].madrugada \u003d m[dia].madrugada + parseFloat(temper);\n                            qtdMadrugada++;\n                        }\n                        else\n                        //MANHA\n                        if (horaConvertida \u003e 600 \u0026\u0026 horaConvertida \u003c\u003d 1300) {\n                            m[dia].manha \u003d m[dia].manha + parseFloat(temper);\n                            qtdManha++;\n                        }\n                        else\n                        //TARDE\n                        if (horaConvertida \u003e 1300 \u0026\u0026 horaConvertida \u003c\u003d 1800) {\n                            m[dia].tarde \u003d m[dia].tarde + parseFloat(temper);\n                            qtdTarde++;\n                        }\n                        else\n                        //NOITE\n                        if (horaConvertida \u003e 1800 \u0026\u0026 horaConvertida \u003c\u003d 2359) {\n                            m[dia].noite \u003d m[dia].noite + parseFloat(temper);\n                            qtdNoite++;\n                        }\n                        \n                        //MIN e MAX\n                        if(parseFloat(temper) \u003c m[dia].minima){\n                          m[dia].minima \u003d parseFloat(temper);\n                          m[dia].horaMinima \u003d hora;\n                        }\n                        if(parseFloat(temper) \u003e m[dia].maxima){\n                          m[dia].maxima \u003d parseFloat(temper);\n                          m[dia].horaMaxima \u003d hora;\n                        }\n\n                    }\n                    else {\n                        m[dia].media \u003d parseFloat(arredonda(m[dia].media / qtd));\n                        m[dia].madrugada \u003d parseFloat(arredonda(m[dia].madrugada / qtdMadrugada));\n                        m[dia].manha \u003d parseFloat(arredonda(m[dia].manha / qtdManha));\n                        m[dia].tarde \u003d parseFloat(arredonda(m[dia].tarde / qtdTarde));\n                        m[dia].noite \u003d parseFloat(arredonda(m[dia].noite / qtdNoite));\n\n                        qtd \u003d 0;\n                        qtdMadrugada \u003d 0;\n                        qtdManha \u003d 0;\n                        qtdTarde \u003d 0;\n                        qtdNoite \u003d 0;\n\n                        dia++;\n                        dataAtual \u003d data;\n\n                        m.push({\n                            \u0027data\u0027: null,\n                            \u0027media\u0027: 0.00,\n                            \u0027minima\u0027: 50.0,\n                            \u0027horaMinima\u0027: null,\n                            \u0027maxima\u0027: 0.00,\n                            \u0027horaMaxima\u0027: null,\n                            \u0027madrugada\u0027: 0.00,\n                            \u0027manha\u0027: 0.00,\n                            \u0027tarde\u0027: 0.00,\n                            \u0027noite\u0027: 0.00,\n                        });\n\n                        m[dia].data \u003d data;\n                        m[dia].media \u003d m[dia].media + parseFloat(temper);\n                        qtd++;\n                        m[dia].madrugada \u003d m[dia].madrugada + parseFloat(temper);\n                        qtdMadrugada++;\n                        \n                        //MIN e MAX\n                        if(parseFloat(temper) \u003c m[dia].minima){\n                          m[dia].minima \u003d parseFloat(temper);\n                          m[dia].horaMinima \u003d hora;\n                        }\n                        if(parseFloat(temper) \u003e m[dia].maxima){\n                          m[dia].maxima \u003d parseFloat(temper);\n                          m[dia].horaMaxima \u003d hora;\n                        }\n                    }\n\n                    var strTable \u003d \u0027\u003ctr\u003e\u0027 +\n                        \u0027\u003ctd\u003e\u0027 + data + \u0027\u003c/td\u003e\u0027 +\n                        \u0027\u003ctd\u003e\u0027 + hora + \u0027\u003c/td\u003e\u0027 +\n                        \u0027\u003ctd\u003e\u0027 + temper + \u0027\u003c/td\u003e\u0027 +\n                        \u0027\u003c/tr\u003e\u0027;\n                    $(\u0027#tabelaDados\u0027).append(strTable);\n                }\n\n\n            }\n            m[dia].media \u003d parseFloat(arredonda(m[dia].media / qtd));\n            m[dia].madrugada \u003d parseFloat(arredonda(m[dia].madrugada / qtdMadrugada));\n            m[dia].manha \u003d parseFloat(arredonda(m[dia].manha / qtdManha));\n            m[dia].tarde \u003d parseFloat(arredonda(m[dia].tarde / qtdTarde));\n            m[dia].noite \u003d parseFloat(arredonda(m[dia].noite / qtdNoite));\n            console.log(m);\n            \n            Materialize.toast(\u0027Dados atualizados!\u0027, 2500);\n            //desenha o gráfico\n            drawChart();\n            $(\u0027.tooltipped\u0027).tooltip({delay: 50});\n\n        }\n\n        function erro(erro) {\n            alert(\"Algo de errado não está certo! \" + erro);\n        }\n\n        // Load the Visualization API and the corechart package.\n        google.charts.load(\u0027current\u0027, {\n            \u0027packages\u0027: [\u0027corechart\u0027]\n        });\n        // Set a callback to run when the Google Visualization API is loaded.\n        //google.charts.setOnLoadCallback(drawChart);\n        // Callback that creates and populates a data table,\n        // instantiates the pie chart, passes in the data and\n        // draws it.\n\n        function drawChart() {\n            var strMedias \u003d \u0027\u0027;\n            // Create the data table.\n            var dataGrafico \u003d new google.visualization.DataTable();\n            dataGrafico.addColumn(\u0027string\u0027, \u0027Data\u0027);\n            dataGrafico.addColumn(\u0027number\u0027, \u0027Temperatura (ºC)\u0027);\n            for (var i \u003d 0; i \u003c m.length; i++) {\n                //strMedias +\u003d \u0027\u003cdiv class\u003d\"card-panel hoverable\"\u003e\u0027 + m[i].data + \u0027 \u0026#8594; \u0027 + m[i].media + \u0027 ºC\u003c/div\u003e\u0027;\n                strMedias +\u003d \u0027\u003cdiv class\u003d\"card-panel center-align\"\u003e\u0027 +\n                    \u0027\u003cdiv class\u003d\"row\"\u003e\u0027 +\n                      \u0027\u003cdiv class\u003d\"chip\"\u003e\u0027 +\n                        \u0027\u003ci class\u003d\"fa fa-calendar\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e \u0027 + m[i].data +\n                      \u0027\u003c/div\u003e\u0027 +\n                    \u0027\u003c/div\u003e\u0027 +\n                    \u0027\u003cp class\u003d\"grey-text text-darken-1\"\u003e\u003ci class\u003d\"fa fa-thermometer-half\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e Média \u0026#8594; \u0027 + m[i].media + \u0027 ºC\u003c/p\u003e\u0027 +\n                    \u0027\u003cp class\u003d\"blue-text text-darken-4 tooltipped\" data-position\u003d\"right\" data-tooltip\u003d\"\u0027 + m[i].data + \u0027 \u0026#8594; \u0027 + m[i].horaMinima + \u0027h\"\u003e\u003ci class\u003d\"fa fa-snowflake-o\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e Mínima \u0026#8594; \u0027 + m[i].minima + \u0027 ºC\u003c/p\u003e\u0027 +\n                    \u0027\u003cp class\u003d\"orange-text text-deep tooltipped\" data-position\u003d\"right\" data-tooltip\u003d\"\u0027 + m[i].data + \u0027 \u0026#8594; \u0027 + m[i].horaMaxima + \u0027h\"\u003e\u003ci class\u003d\"fa fa-sun-o\" aria-hidden\u003d\"true\"\u003e\u003c/i\u003e Máxima \u0026#8594; \u0027 + m[i].maxima + \u0027 ºC\u003c/p\u003e\u0027 +\n                \u0027\u003c/div\u003e\u0027;\n                dataGrafico.addRows([\n                    [m[i].data + \u0027 (Madrugada)\u0027, m[i].madrugada],\n                    [m[i].data + \u0027 (Manhã)\u0027, m[i].manha],\n                    [m[i].data + \u0027 (Tarde)\u0027, m[i].tarde],\n                    [m[i].data + \u0027 (Noite)\u0027, m[i].noite]\n                ]);\n            }\n            $(\"#medias\").html(strMedias);\n            // Set chart options\n            var options \u003d {\n                \u0027title\u0027: \u0027Média de temperaturas (\u0027 + m[0].data + \u0027 até \u0027 + m[m.length - 1].data + \u0027)\u0027,\n                \u0027width\u0027: 550,\n                \u0027height\u0027: 400\n            };\n            // Instantiate and draw our chart, passing in some options.\n            var chart \u003d new google.visualization.ColumnChart(document.getElementById(\u0027grafico\u0027));\n            chart.draw(dataGrafico, options);\n        }\n    \u003c/script\u003e\n\u003c/body\u003e\n\n\u003c/html\u003e\n"}]}